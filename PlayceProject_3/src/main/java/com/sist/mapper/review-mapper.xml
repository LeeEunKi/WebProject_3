<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sist.mapper.review-mapper">
<!-- no        NUMBER,
	content   VARCHAR2(1500)		 CONSTRAINT review_content_nn NOT NULL,
	regdate   DATE    			 DEFAULT SYSDATE,
	imgname   VARCHAR(500),
	imgsize     VARCHAR(500),
	place_no  NUMBER     		 NOT NULL,
	member_id VARCHAR2(30)  		 NOT NULL,
	score	NUMBER			 CONSTRAINT review_score_nn NOT NULL,
	CONSTRAINT review_3_no_pk PRIMARY KEY(no)
	rcount NUMBER DEFAULT 0
 -->
 
<!--  댓글 카운트 -->
<update id="countIncrement" parameterType="ReviewVO">
   UPDATE REVIEW_3 SET
   rcount=rcount+1
   WHERE no=#{place_no}
</update>

<!--  상세보기 리뷰 리스트 -->
<select id="reviewListData" resultType="ReviewVO" parameterType="ReviewVO">
  SELECT /*+ INDEX_DESC(REVIEW_3 review_3_no_pk)*/ no,place_no,member_id,<!-- imgname -->content,score,TO_CHAR(regdate,'YYYY.MM.DD') AS dbday
  FROM REVIEW_3
  WHERE place_no=#{place_no}
</select>

<!-- 리뷰 등록 -->
<insert id="reviewInsert" parameterType="ReviewVO">
   <!--  시퀀스 처리 -->
   <selectKey keyProperty="no" resultType="int" order="BEFORE">
      SELECT NVL(MAX(no)+1,1) AS no FROM REVIEW_3
   </selectKey>
   INSERT INTO REVIEW_3 VALUES(
	#{no},
	#{place_no},
	#{member_id},
	#{content},
	#{score},
	<!--#{imgname} 사진을 어떻게 처리할지 몰라서 일단 보류 -->
	SYSDATE
   )
</insert>

<!--마이페이지 -> 리뷰 수정 -->
<update id="reviewUpdate" parameterType="ReviewVO">
 UPDATE REVIEW_3 SET
 content=#{content}
 score=#{score} <!--평점도 수정해야 -->
 <!-- 여기도 사진 수정할 수 있도록,,, -->
 WHERE no=#{no}
 </update>

<!-- 삭제 -->
<delete id="reivewDelete" parameterType="int">
  DELETE FROM REVIEW_3
  WHERE no=#{no}
</delete>

</mapper>